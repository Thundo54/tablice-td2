function refreshTimetablesAnim(){var t,i,n,a=$("#timetables").find("tr");for(let e=0;e<a.length;e++){t=$(a[e]).find("td");for(let e=0;e<t.length;e++)n=10*((i=$(t[e]).find("p")).width()+$(t[e]).width())/950,i.css("animation-duration")!==n&&(i.width()>$(t[e]).width()?(i.css("animation",`ticker linear ${n}s infinite`),i.css("--elementWidth",$(t[e]).width())):i.css("animation",""))}}function getTimetables(){var e=$.ajax({url:"https://gist.githubusercontent.com/Thundo54/bba89c9eba39921844eec0013c9c1c40/raw/96b70b491f68d7400b5ac11fce8d54f226f4047c/gistfile1.txt",async:!1}).responseText;return JSON.parse(e)}function getSceneries(){var e=$.ajax({url:"https://spythere.pl/api/getSceneries",async:!1}).responseText;return JSON.parse(e)}function capitalizeFirstLetter(e){if(e!==e.toUpperCase())return e;{let t="";return e.split(" ").forEach(e=>{t+=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()+" "}),t.slice(0,-1)}}function splitRoute(e){let t=[];return e.split("|").forEach(e=>{t.push(capitalizeFirstLetter(e))}),t}function parseTimetable(e,t=!0){let i=[],n={},a=[];var r,s=getTimetables();for(r in s)if(void 0!==s[r].timetable){for(var o in s[r].timetable.stopList)s[r].timetable.stopList[o].stopType.includes("ph")&&a.push(capitalizeFirstLetter(s[r].timetable.stopList[o].stopNameRAW.split(",")[0])),capitalizeFirstLetter(s[r].timetable.stopList[o].stopNameRAW)!==e||s[r].timetable.stopList[o].confirmed||(t&&!s[r].timetable.stopList[o].terminatesHere?(n.beginsTerminatesHere=s[r].timetable.stopList[o].beginsHere,n.timestamp=s[r].timetable.stopList[o].departureTimestamp,n.delay=s[r].timetable.stopList[o].departureDelay,n.stationFromTo=splitRoute(s[r].timetable.route)[1]):t||s[r].timetable.stopList[o].beginsHere||(n.beginsTerminatesHere=s[r].timetable.stopList[o].terminatesHere,n.timestamp=s[r].timetable.stopList[o].arrivalTimestamp,n.delay=s[r].timetable.stopList[o].arrivalDelay,n.stationFromTo=splitRoute(s[r].timetable.route)[0]));0<a.length&&void 0!==n.timestamp&&(n.timetable=t?a.slice(a.indexOf(e)+1):a.slice(0,a.indexOf(e)),n.category=s[r].timetable.category,n.trainNo=s[r].trainNo,i.push(n)),a=[],n={}}return window.trainsSetBefore=i.sort((e,t)=>e.timestamp-t.timestamp),i.sort((e,t)=>e.timestamp-t.timestamp)}function loadSceneries(){var e,t,i,n=getTimetables(),a=getSceneries();let r=[];for(e in n)if(void 0!==n[e].timetable)for(var s in n[e].timetable.stopList)n[e].timetable.stopList[s].confirmed||n[e].timetable.stopList[s].mainStop&&"eu"===n[e].region&&r.push(n[e].timetable.stopList[s].stopNameRAW);for(t in r=r.filter((e,t,i)=>i.indexOf(e)===t))for(var o in a)null!==a[o].checkpoints&&a[o].checkpoints.toLowerCase().includes(r[t].toLowerCase())&&(console.log(r[t]),r[t]=a[o].name);for(i in(r=r.filter((e,t,i)=>i.indexOf(e)===t)).sort((e,t)=>e<t?-1:t<e?1:0),r)$("#active-timetables").append($("<option>").text(capitalizeFirstLetter(r[i])));console.log(r)}function loadTimetables(e,t=!0){let i=window.trainsSetBefore,n=parseTimetable(e,t);var a,r=n.filter(e=>!i.map(e=>e.trainNo).includes(e.trainNo)),s=i.filter(e=>!n.map(e=>e.trainNo).includes(e.trainNo));if(0===i.length&&0<n.length||0===$("#timetables tr").length){for(var o in n)$("#timetables").append(addRow(n[o].timestamp,n[o].trainNo,n[o].stationFromTo,n[o].timetable.join(", "),n[o].category,"1",createRemark(n[o].delay,t,n[o].beginsTerminatesHere),o));refreshIds()}else{if(0<s.length)for(var l in s){var p=i.indexOf(s[l]);console.log(`Usunięto pociąg ${s[l].trainNo} (${convertTime(s[l].timestamp)}) => INDEX `+p),$("#"+p).remove(),refreshIds()}if(0<r.length)for(var d in console.log("Pociągi do dodania",r),r){var c=n.indexOf(r[d]),d=(console.log(`Dodano pociąg ${r[d].trainNo} (${convertTime(r[d].timestamp)}) => INDEX `+c),addRow(r[d].timestamp,r[d].trainNo,r[d].stationFromTo,r[d].timetable.join(", "),r[d].category,"1",createRemark(r[d].delay,t,r[d].beginsTerminatesHere),d));0===c?$("#1").before(d):$("#"+(c-1)).after(d),refreshIds()}}for(a in n)$(`#${a} td:nth-child(7) p`).text(createRemark(n[a].delay,t,n[a].beginsTerminatesHere),n[a].trainNo);refreshTimetablesAnim()}function refreshIds(){let e=0;$("#timetables tr").each(function(){$(this).attr("id",e),e++})}function convertCategory(e){return"EIE"===e?"IC":"MPE"===e?"TLK":"R"}function convertTime(e){return new Date(e).toLocaleTimeString("pl-PL",{hour:"2-digit",minute:"2-digit"})}function createTrainString(e,t){return convertCategory(e)+" "+t}function createRemark(e=0,t=!0,i=!1){return 0<e?`Opóźniony ${e}min/delayed ${e}min/verspätung ${e}min`:i?t?"Pociąg rozpoczyna bieg/train begins here/zug beginnt hier":"Pociąg kończy bieg/train terminates here/zug endet hier":""}function refreshTimetables(){}function addRow(e,t,i,n,a,r,s,o){o=$("<tr>").attr("id",""+o);return o.append($("<td>").text(convertTime(e))),o.append($("<td>").append($("<div>").append($("<p>").text(createTrainString(a,t))))),o.append($("<td>").append($("<p>").text(i))),o.append($("<td>").append($("<p>").text(n))),o.append($("<td>").text(a)),o.append($("<td>").text(r)),o.append($("<td>").append($("<p>").text(s))),o}function addSpecialRow(e,t){$(`#timetables tr:nth-child(${e})`).after($("<tr>").append($("<td>").attr("colspan",7).append($("<div>").addClass("special-row").append($("<p>").text(t))))),refreshTimetablesAnim()}function getTrainsFromRows(){let e={},t={};return $("#timetables tr td:nth-child(2) p").each(function(){e.rowNo=$(this).closest("tr").index()+1,t[$(this).text().split(" ")[1]]=e,e={}}),t}function changeBoardType(e=!0){let t,i,n,a;a=e?(t="Odjazdy",i="Departures",n="Do<br><i>Destination</i>","#FFD200"):(t="Przyjazdy",i="Arrivals",n="Z<br><i>From</i>","#F0F8FF"),$("#title-pl").text(t),$("#title-en").text(i),$("#description th:nth-child(3)").html(n),$("#container").css("color",a)}function displayMenu(){var e=$("#menu-holder");"none"===e.css("display")?e.css("display","flex"):e.css("display","none")}function changeTimetables(){var e=$("#active-timetables option:selected").text();$("#timetables tr").remove(),loadTimetables(window.scenery=e)}function changeTableVersion(){var e=$("#tables option:selected").index();$("#timetables tr").remove(),0===e?(changeBoardType(!0),loadTimetables(window.scenery)):(changeBoardType(!1),loadTimetables(window.scenery,!1))}window.timetableAsJson=[],window.sceneriesAsJson=[],window.trainsSetBefore=[],window.isDeparture=!0,$(document).ready(function(){loadSceneries(),changeBoardType(!0)}),$(window).resize(function(){clearTimeout(window.resizedFinished),window.resizedFinished=setTimeout(function(){refreshTimetablesAnim()},250)}),window.scenery="";